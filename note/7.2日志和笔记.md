# 7.2 日志和笔记

qemu 的 -kernel 选项可以直接启动内核，并且将内核放在0x8000的位置，因此我们不打算写bootloader等东西，直接用-kernel选项运行elf文件。

## gcc 编译流程

- gcc -c 选项生成的.o文件是二进制文件，但是没有对地址进行重新定位

- gcc链接过程中调用ld链接器的时候使用了默认脚本，可以使用ld --verbose查看默认的编译脚本
  
## ELF文件加载要做的事情
- 文件加载初期需要执行一系列初始化的操作才能完成文件的执行
- 在linux系统下执行main函数之前要先执行_start函数，对堆栈等东西进行必要的初始化操作

- 我们要使用自己的链接脚本，把内核定位到0x8000的位置

## ld 链接脚本学习
- OUTPUT_ARCH 输出平台
- ENTRY( _entry ) 入口函数
- SECTIONS 节

## ld 脚本需要实现的东西
- 重定向入口
- 重新指定代码段的内存分配（详情见linux段管理）

## linux 段管理
- linux内存分配的时候是以页为单位进行分配的，而管理这些页的时候是以段来进行管理的
- 常见段有 text段 data段 rodata段 bss段

## gcc参数调整  
由于gcc默认编译的目标环境是在操作系统上面的，所以会默认自动链接系统标准库，我们要加入参数对其进行调整。
- -ffreestanding 告诉编译器去编译一个独立程序，不用连接crt0.o等等
- nostdlib  告诉编译器，没有标准库，不用连接标准库

## makefile 中tags和下面的etags可以自动生成想要的文件
- 需要自定义 CC AS LD 等参数，不然就会采用默认的参数进行